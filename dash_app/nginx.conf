# --------------------------------------------------
#  nginx reverse proxy → Dash (Waitress on port 8050)
# --------------------------------------------------
#  使い方:
#    1. nginx をインストール (https://nginx.org/en/download.html)
#    2. このファイルを nginx/conf/ にコピーまたはシンボリックリンク
#    3. nginx.conf の http ブロックで  include  path/to/this_file;
#       または直接 server ブロックを差し替え
#    4. nginx -s reload
# --------------------------------------------------

server {
    listen       80;
    server_name  localhost;

    # --- 静的アセット (Dash の assets/) ---
    location /assets/ {
        alias  D:/github-copilot/ImageProcess01/dash_app/assets/;
        expires 1d;
    }

    # --- Dash アプリへのリバースプロキシ ---
    location / {
        proxy_pass         http://127.0.0.1:8050;
        proxy_http_version 1.1;

        # WebSocket (Dash の Hot Reload / コールバック通信)
        proxy_set_header   Upgrade    $http_upgrade;
        proxy_set_header   Connection "upgrade";

        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;

        proxy_read_timeout  300s;
        proxy_send_timeout  300s;
    }
}
